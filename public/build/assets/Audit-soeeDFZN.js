import{r as a,j as e,L as B,S as d}from"./app-D8uQYgvl.js";import{A as M,D as A}from"./app-layout-B5_O5D4_.js";import{R as z}from"./refresh-cw-DfnwGdDe.js";import{F as H}from"./filter-BcLyhxPC.js";import{S as J}from"./search-Cbj0fXO4.js";import{S as X}from"./shield-Q_hQjvIf.js";import{C as q}from"./clock-n0ESeOyk.js";import{U as G,A as _,F as K}from"./users-UtEP8ujb.js";import{E as U}from"./eye-B5UCNg4s.js";import{U as Q,a as W}from"./user-x-Drzkf_wk.js";import{T as Y}from"./trash-2-ClrFe1dn.js";import{C as Z}from"./circle-check-big-DEcvGDMg.js";import"./app-BHZg9BJg.js";import"./createLucideIcon-Dygev6kt.js";const V=[{title:"Admin Dashboard",href:"/admin/dashboard"},{title:"System Management"},{title:"Audit Trail"}];function ge({auditEntries:t,filters:l,users:h}){var S,C;const[x,b]=a.useState(l.search||""),[i,y]=a.useState(l.severity||"all"),[c,j]=a.useState(l.action||"all"),[n,f]=a.useState(l.resource||"all"),[o,k]=a.useState(l.user||"all"),[m,v]=a.useState(l.date_from||""),[g,N]=a.useState(l.date_to||""),[w,T]=a.useState(null),[p,u]=a.useState(!1),D=r=>{switch(r.toLowerCase()){case"create":case"created":return e.jsx(Z,{className:"h-4 w-4 text-green-600"});case"update":case"updated":return e.jsx(K,{className:"h-4 w-4 text-blue-600"});case"delete":case"deleted":return e.jsx(Y,{className:"h-4 w-4 text-red-600"});case"login":return e.jsx(W,{className:"h-4 w-4 text-green-600"});case"logout":return e.jsx(Q,{className:"h-4 w-4 text-gray-600"});case"view":case"accessed":return e.jsx(U,{className:"h-4 w-4 text-blue-600"});case"download":return e.jsx(A,{className:"h-4 w-4 text-purple-600"});default:return e.jsx(_,{className:"h-4 w-4 text-gray-600"})}},L=r=>{const s={low:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400",critical:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s[r]||s.low}`,children:r.charAt(0).toUpperCase()+r.slice(1)})},F=r=>{const s={Admin:"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400",Client:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",User:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400"};return e.jsx("span",{className:`inline-flex items-center rounded px-2 py-1 text-xs font-medium ${s[r]||s.User}`,children:r})},R=r=>new Date(r).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),I=()=>{u(!0),d.get("/admin/audit",{search:x,severity:i!=="all"?i:"",action:c!=="all"?c:"",resource:n!=="all"?n:"",user:o!=="all"?o:"",date_from:m,date_to:g},{preserveState:!0,onFinish:()=>u(!1)})},$=()=>{b(""),y("all"),j("all"),f("all"),k("all"),v(""),N(""),u(!0),d.get("/admin/audit",{},{preserveState:!0,onFinish:()=>u(!1)})},O=()=>{const r=new URLSearchParams;x&&r.append("search",x),i!=="all"&&r.append("severity",i),c!=="all"&&r.append("action",c),n!=="all"&&r.append("resource",n),o!=="all"&&r.append("user",o),m&&r.append("date_from",m),g&&r.append("date_to",g),window.open(`/admin/audit/export?${r.toString()}`,"_blank")},P=(r,s)=>!r&&!s?null:e.jsxs("div",{className:"mt-3 space-y-2",children:[r&&Object.keys(r).length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium tracking-wide text-gray-500 uppercase dark:text-gray-400",children:"Previous Values"}),e.jsx("div",{className:"mt-1 rounded bg-red-50 p-2 dark:bg-red-900/10",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap text-red-800 dark:text-red-300",children:JSON.stringify(r,null,2)})})]}),s&&Object.keys(s).length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium tracking-wide text-gray-500 uppercase dark:text-gray-400",children:"New Values"}),e.jsx("div",{className:"mt-1 rounded bg-green-50 p-2 dark:bg-green-900/10",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap text-green-800 dark:text-green-300",children:JSON.stringify(s,null,2)})})]})]});return e.jsxs(M,{breadcrumbs:V,children:[e.jsx(B,{title:"System Audit Trail"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"System Audit Trail"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track all system activities and user actions for security and compliance"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:O,className:"inline-flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-green-700",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsxs("button",{onClick:()=>d.reload(),className:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),e.jsxs("div",{className:"rounded-lg bg-white p-6 shadow dark:bg-gray-800",children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Search"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(J,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:r=>b(r.target.value),placeholder:"Search descriptions, resources...",className:"block w-full rounded-lg border border-gray-300 bg-white py-2 pr-3 pl-10 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Severity"}),e.jsxs("select",{value:i,onChange:r=>y(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Action"}),e.jsxs("select",{value:c,onChange:r=>j(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Actions"}),e.jsx("option",{value:"create",children:"Create"}),e.jsx("option",{value:"update",children:"Update"}),e.jsx("option",{value:"delete",children:"Delete"}),e.jsx("option",{value:"login",children:"Login"}),e.jsx("option",{value:"logout",children:"Logout"}),e.jsx("option",{value:"view",children:"View"}),e.jsx("option",{value:"download",children:"Download"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Resource"}),e.jsxs("select",{value:n,onChange:r=>f(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Resources"}),e.jsx("option",{value:"DCInstallation",children:"DC Installation"}),e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"System",children:"System"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"User"}),e.jsxs("select",{value:o,onChange:r=>k(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Users"}),h==null?void 0:h.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date From"}),e.jsx("input",{type:"date",value:m,onChange:r=>v(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date To"}),e.jsx("input",{type:"date",value:g,onChange:r=>N(r.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{onClick:I,disabled:p,className:"flex-1 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700 disabled:opacity-50",children:p?"Searching...":"Apply Filters"}),e.jsx("button",{onClick:$,disabled:p,className:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Reset"})]})]})]}),e.jsxs("div",{className:"rounded-lg bg-white shadow dark:bg-gray-800",children:[e.jsx("div",{className:"border-b border-gray-200 p-6 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center text-lg font-semibold text-gray-900 dark:text-white",children:[e.jsx(X,{className:"mr-2 h-5 w-5 text-blue-600 dark:text-blue-400"}),"Audit Entries"]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[((S=t==null?void 0:t.meta)==null?void 0:S.total)||0," total entries"]})]})}),e.jsxs("div",{className:"p-6",children:[((C=t==null?void 0:t.data)==null?void 0:C.length)>0?e.jsx("div",{className:"space-y-4",children:t.data.map(r=>{var s;return e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-colors hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-700/50 dark:hover:bg-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:D(r.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.user_name}),F(r.user_type),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.action.toLowerCase(),"d"]}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.resource_type}),r.resource_id&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["#",r.resource_id]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:r.description}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(q,{className:"mr-1 h-3 w-3"}),R(r.created_at)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(G,{className:"mr-1 h-3 w-3"}),r.ip_address]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[L(r.severity),e.jsx("button",{onClick:()=>T(w===r.id?null:r.id),className:"rounded p-1 text-gray-400 hover:bg-gray-200 hover:text-gray-600 dark:hover:bg-gray-600 dark:hover:text-gray-300",children:e.jsx(U,{className:"h-4 w-4"})})]})]}),w===r.id&&e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4 dark:border-gray-600",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium tracking-wide text-gray-500 uppercase dark:text-gray-400",children:"User Details"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:[e.jsxs("p",{children:["Email: ",r.user_email]}),e.jsxs("p",{children:["Type: ",r.user_type]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium tracking-wide text-gray-500 uppercase dark:text-gray-400",children:"Technical Details"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:[e.jsxs("p",{children:["IP: ",r.ip_address]}),e.jsxs("p",{className:"truncate",title:r.user_agent,children:["User Agent: ",(s=r.user_agent)==null?void 0:s.substring(0,50),"..."]})]})]})]}),P(r.old_values,r.new_values)]})]},r.id)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(_,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No audit entries found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Try adjusting your filters or check back later."})]}),(t==null?void 0:t.links)&&t.links.length>3&&e.jsxs("div",{className:"mt-6 flex items-center justify-between border-t border-gray-200 pt-6 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[t.links[0].url&&e.jsx("button",{onClick:()=>d.get(t.links[0].url),className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Previous"}),t.links[t.links.length-1].url&&e.jsx("button",{onClick:()=>d.get(t.links[t.links.length-1].url),className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300"})}),e.jsx("div",{children:e.jsx("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm",children:t.links.map((r,s)=>e.jsx("button",{onClick:()=>r.url&&d.get(r.url),disabled:!r.url,className:`relative inline-flex items-center px-4 py-2 text-sm font-medium focus:z-20 focus:outline-none ${r.active?"z-10 border-blue-500 bg-blue-50 text-blue-600":r.url?"border-gray-300 bg-white text-gray-500 hover:bg-gray-50":"cursor-not-allowed border-gray-300 bg-gray-100 text-gray-300"} ${s===0?"rounded-l-md":""} ${s===t.links.length-1?"rounded-r-md":""}`,dangerouslySetInnerHTML:{__html:r.label}},s))})})]})]})]})]})]})]})}export{ge as default};
